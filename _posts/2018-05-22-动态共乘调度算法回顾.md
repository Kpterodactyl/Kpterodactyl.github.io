---
layout:     post
title:      动态共乘调度算法回顾
subtitle:   论文阅读笔记
date:       2018-05-22  08:15:08 +0800
author:     Memory
header-img: img/post-bg-js-module.jpg
catalog: 数据结构
tags:
    - Dijkstra
---
出租车服务是城市交通的重要组成部分，对交通阻塞和空气污染造成了巨大的影响，对人体健康有着重大不利影响，共享出粗车出行时一种可以消除这种影响的可能途径。
以下内容为拼车算法涉及的经典论文汇总整理：

1. Santi, Paolo, et al. "Quantifying the benefits of vehicle pooling with shareability networks." Proceedings of the National Academy of Sciences 111.37 (2014): 13290-13294.

2. Ma S, Zheng Y, Wolfson O (2013) T-Share: A large-scale dynamic taxi ridesharing service. Proc IEEE ICDE (IEEE, Brisbane, QLD), pp 410–421


3. Ta, Na, et al. "An Efficient Ride-Sharing Framework for Maximizing Shared Route." IEEE Transactions on Knowledge and Data Engineering 30.2 (2018): 219-233.


拼车算法的基本实现思路为：根据打车人口密度和时间、地点上下文确定最优路线，本质还是特征选择。在算法模型中，城市路网抽象为一个有向图结构：节点表示十字路口，边表示道路；但对于拼车业务，优先选择拼车密度大的路径。有了模型，就可以用路径规划算法来寻优。最简单的是Dijkstra搜索算法，也是今天大多数搜索算法的基石，但是在工程环境下，Dijkstra没法处理大规模的图结构，因为搜索效率低；于是变通为层次结构来提升性能，通过预处理所有短路线，达到毫秒级的全路径计算。

所以最终的方案应该是：实时刷新部分图结构完成预处理，并将图结构划分为一个个小格栅，通过并行计算加速服务响应。

具体实现可参考——**Uber 路径优化开源项目**（https://github.com/Project-OSRM/osrm-backend）

**Hubcab** 上面给出的纽约拼车的解决方案，是物联网和数据分析相结合的产物
http://hubcab.org/#13.00/40.7371/-73.9221

## 论文1对应Hubcab系统 ##

用大数据的方法，将拼车这个时空共享问题，转换成了图论（Graph Theory）框架，发明了“共享网络”（Shareability Network）模型。实验背景为曼哈顿，在实验中定义了两个参数：可共乘系数k－最大可共乘路程数，服务质量Δ－用户可承受的最大服务延迟（即时间窗），选择将服务质量参数定义为绝对时间，而不是作为旅行时间的百分比增加，是合理的，在文献（T－share）中也有类似的实现。

可共享网络将时空共享问题转化为提供高效解决方案的图论框架。
[![image.jpg](https://s31.postimg.cc/foq3yk8d7/image.jpg)](https://postimg.cc/image/u7x8zz1hz/)

**A**表示7个请求在曼哈顿。

**B**构建k＝2的共享网络，可能潜在的旅行被连接在一起的，如果满足时间窗限制。行程1和4不能被共享因为共享行程的总长应该大于单个行程相加之和。同样行程7是一个孤立的路线，无法和其它行程共享。

**C**可共享网络的最大匹配的到了最大数量的共享旅程对。

**D**实现最大匹配的策略结果。

**E**或者，根据最大加权得到可共享性网络的匹配策略，给出解决方案应具有最小的总行程时间，在这种情况下的结果会与未加权的最大匹配的解决方案不同。在图中的示例中，只有两对旅行是共享的，但节省的行程时间量，由匹配的链路权重总和30 + 16给出，是最佳的策略（k=2只能两两组合）。

**F**实现最大权重的策略结果。

**G**图中三种情况中的每一种都涉及多次要共享的行程Ti，每个情况的行程初始时间不同。最上边的情况， k=2对应的出租车可容纳量≥2。中间的情况，k＝3三段旅程可以被共享，但对应的出租车可容纳量≥2即可，因为T2和T3没有交叠。最下面的情况，k=3,对应的出租车可容纳量≥3(假设每段旅程对应的乘客数为1，根据Bloomberg M, Yassky D (2014) New York City 2014 Taxicab FactBook (New York City Taxi and Limousine Commission, New York)的报告中总结，平均乘客数为1.3)

如上图所示，在共享网络中如果两个点间的距离可以满足服务质量Δ的约束，则可以在两点之间建立一条连线（A和B图），服务质量Δ的大小对共享网络拓扑的性质有着很大的影响，由于时间聚合网络的影响，Δ增加共享拓扑会变得致密，用更直观的方式来表示就是乘客对于共乘的时间窗越大，等待约有耐心，可共乘的可能性越大，如下图所示(图中示范的为100个连续的行程对于两个不同的Δ，图中并不体现节点位置)。对于k>2的值，可共享性网络的超图结构中至多k个节点可以通过链接同时连接。由于计算原因k值对问题的可解决性有实质的影响，当k = 2时问题易于处理，当k=3时，启发式可行，而k≥4时，计算难以处理。这个约束意味着出租车共享服务这一应用程序，可能只能结合一个有限的旅行次数。但是，正如我们下面结果所示，即使是最低限度可能的行程组合数量（k = 2）可以提供巨大的数量的共乘对于像纽约这样密集的社区。
[![image.png](https://s31.postimg.cc/qbjx40bdn/image.png)](https://postimg.cc/image/e9oj9v253/)
可以根据如下两个标准确定最优的共乘策略：

1.最大化可共乘的数量

2.最小各旅程的累积时间

### 实验部分 ###
在实验中应用了New York 2011年的数据集，生成的共享网络有约150百万的节点和大于100百万的边。在整个共享网络已知的情况下，应用最大化可共乘数量的策略，采用Oracle approach models，得到了A和B结果。B图为将共享行程的百分比作为最大化共享行程（最大行程）的两个考虑的优化标准，并最大限度地减少总行程时间（最短时间），最多可分享k = 2次行程。C图通过固定公式随机去掉部分旅程，来调整每天的旅程数。
[![image.png](https://s31.postimg.cc/vmytor017/image.png)](https://postimg.cc/image/5enozdfxj/)

## 论文2TShare ##

论文实现的效果为多服务了25%的出租车用户同时减少了13%的行驶距离。主要创新点为：

1.通过时空索引的方式完成快速的候选出租车搜索策略

2.惰性的最短路径计算方法

动态拼车问题本质上是一个类似贪婪问题的求解，最小化出租车总行驶路程是一个NP难问题，可抽象为Total Distance Optimization Taxi Ridesharing Problem (TDOTRP)作为Travelling Salesman Problem with Time Window (TSPTW)旅行商问题的概括。

[![image.png](https://s31.postimg.cc/3t8f7axx7/image.png)](https://postimg.cc/image/5xss8dzjr/)

文中建立了动态共乘服务的框架，如红色箭头箭头所示，出租车在参加搭乘服务时，或者乘客上下车时或者在某个频率（例如，每20分钟一次）将其状态上载到运营中心），同时连接到服务。该系统维护出租车的**时空索引**以用于快速用户查询处理。一旦收到出租车的新状态或出租车的路线被服务重新安排，索引将被更新。

乘客向系统提交查询并接收服务的回应。如实线蓝色箭头所示，系统的所有传入查询都会流入**队列**，并按照**先来先服务原则**进行处理。对于查询队列顶部的每个查询队列，系统调用Taxi Searching模块来搜索一组可能基于最新索引满足查询的候选出租车{Taxis}。给定结果集{Taxis}，系统调用Scheduling模块将插入请求去查询结果集中满足条件的出租车（请求的乘客数小于出租车的承载范围，满足请求乘客的时间窗限制且满足待插入出租车当前乘客的时间窗限制）。如果请求可以被满足，给乘客响、通知出租车、并更新时空索引。

虽然从需求上来看K Nearest Neighbour (KNN)近似，但KNN并不完全适用，动态共乘的需求并不局限于查询附近的K辆车（K为固定值），拼车是根据时间窗过滤掉不符合规定的出租车。文中提出将路网进行网格划分，取路网中心的一个点作为矛点Ci，如图A，计算各个点之间的最短距离和行驶时间（不是本文的重点，选用固定的行驶速度进行估算），距离和时间Dij＝（tij，dij）以矩阵的形式存储，如图B所示。

[![image.png](https://s31.postimg.cc/60h990xqz/image.png)](https://postimg.cc/image/ce6cca2mv/)

每一个网格Gi有**三个列表**用于车辆搜索：**1和2均为静态列表，只需要计算一次。**

1、一个时间顺序的网格列表，从各个网格到Gi所需行驶时间的排序；

2、一个空间有序的网格列表，从各个网格到Gi所需行驶距离的排序；

3、网格内出租车和在特定时间段即将驶入Gi的出租车列表，该列表是动态变化的，每辆车驶出Gi时将被移除，每辆车驶入Gi时将被插入,网格中出租车的时间戳也会在收到更新的GPS信号之后更新。每辆出租车的ID都有时间戳标记；

[![image.png](https://s31.postimg.cc/dym8oa4m3/image.png)](https://postimg.cc/image/bu1vn72zb/)












